<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«è½¦è¿‡å±±æ´é—®é¢˜è®¡ç®—å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-color: #eef5fd; /* Light sky blue background */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
            width: 95%;
            max-width: 650px; /* Wider container */
            margin-bottom: 20px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.6em;
            font-weight: 600;
        }

        .input-section {
            display: grid; /* Use grid for better alignment */
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Responsive columns */
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.95em;
        }
        .input-group label .unit {
            font-size: 0.9em;
            color: #777;
        }

        .input-group input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .input-group input[type="number"]::-webkit-outer-spin-button,
        .input-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        .input-group input[type="number"] { -moz-appearance: textfield; }
        .input-group input[type="number"]:focus {
            outline: none;
            border-color: #5dade2; /* Light blue accent */
            box-shadow: 0 0 0 3px rgba(93, 173, 226, 0.15);
        }

        button#calculate-button {
            background-color: #5dade2; /* Light blue accent */
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 10px;
            width: 100%;
            font-weight: 500;
        }
        button#calculate-button:hover {
            background-color: #3498db; /* Darker blue */
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.85em;
            margin-top: 5px;
            min-height: 1.1em;
            text-align: left;
        }

        /* --- Visualization Area --- */
        .visualization-area, .calculation-area {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
            width: 95%;
            max-width: 650px;
            margin-bottom: 20px;
        }
        .visualization-area h4, .calculation-area h4 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #34495e;
            text-align: center;
            font-weight: 600;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 10px;
        }

        #tunnel-visualization {
            position: relative;
            height: 100px; /* Fixed height for visualization */
            background-color: #f4f4f4;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden; /* Hide overflowing train */
            border: 1px solid #ddd;
        }

        .tunnel {
            position: absolute;
            top: 20px; /* Position tunnel vertically */
            height: 60px;
            background-color: #7f8c8d; /* Gray for tunnel */
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        .tunnel-label {
            position: absolute;
            bottom: -20px; /* Label below tunnel */
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #555;
            white-space: nowrap;
        }


        .train {
            position: absolute;
            top: 30px; /* Align train vertically */
            height: 40px;
            background-color: #e74c3c; /* Red train */
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            white-space: nowrap;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            /* Animation will be controlled by JS */
            left: -200px; /* Start off-screen */
            transition: left 1s linear; /* Smooth movement */
        }
        .train-label {
             position: absolute;
             top: -20px; /* Label above train */
             left: 50%;
             transform: translateX(-50%);
             font-size: 0.8em;
             color: #c0392b;
             white-space: nowrap;
        }

        .distance-marker {
            position: absolute;
            top: 5px;
            height: 10px;
            border-left: 1px dashed #3498db;
        }
        .distance-label {
            position: absolute;
            top: -15px;
            font-size: 0.75em;
            color: #3498db;
            white-space: nowrap;
            transform: translateX(-50%);
        }


        /* --- Calculation Steps Area --- */
        #calculation-steps {
            text-align: left;
            font-size: 1em; /* Slightly larger for kids */
            line-height: 1.8;
            color: #333;
        }
        #calculation-steps p {
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 4px;
            border-left: 4px solid #5dade2;
            background-color: #f8fafd;
        }
         #calculation-steps p.formula {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            background-color: #eaf0ff;
            border-left-color: #3498db;
         }
         #calculation-steps p.important {
             background-color: #fff0f0; /* Highlight important step */
             border-left-color: #e74c3c;
             font-weight: bold;
         }
         #calculation-steps p.mistake {
             background-color: #fef9e7; /* Highlight mistake */
             border-left-color: #f39c12;
             font-style: italic;
         }
         #calculation-steps strong {
             color: #2980b9; /* Blue for emphasis */
         }
         #calculation-steps .unit {
             font-style: italic;
             color: #777;
             font-size: 0.9em;
         }


        /* --- Result Area --- */
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f8f5; /* Light green result */
            border: 1px solid #a3e4d7;
            border-radius: 6px;
            min-height: 30px;
            text-align: center;
        }
        .result-area p {
            margin: 0;
            font-size: 1.2em;
            font-weight: 700;
            color: #16a085; /* Green result */
        }
         .result-area .label {
            font-weight: normal;
            color: #555;
            font-size: 1em;
            display: block;
            margin-bottom: 5px;
         }

    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸš‚ ç«è½¦è¿‡å±±æ´é—®é¢˜ â›°ï¸</h1>

        <div class="input-section">
            <div class="input-group">
                <label for="speed-input">ç«è½¦é€Ÿåº¦ <span class="unit">(ç±³/ç§’)</span>:</label>
                <input type="number" id="speed-input" placeholder="ä¾‹å¦‚ï¼š20" min="0.1" step="any">
                <div id="speed-error" class="error-message"></div>
            </div>

            <div class="input-group">
                <label for="time-input">è¿‡æ´æ—¶é—´ <span class="unit">(ç§’)</span>:</label>
                <input type="number" id="time-input" placeholder="ä¾‹å¦‚ï¼š30" min="0.1" step="any">
                <div id="time-error" class="error-message"></div>
            </div>

             <div class="input-group">
                <label for="train-length-input">ç«è½¦é•¿åº¦ <span class="unit">(ç±³)</span>:</label>
                <input type="number" id="train-length-input" placeholder="ä¾‹å¦‚ï¼š100" min="1">
                <div id="train-length-error" class="error-message"></div>
            </div>
        </div>

        <button id="calculate-button">è®¡ç®—å±±æ´é•¿åº¦</button>

        <div class="result-area">
            <p id="result-output"><span class="label">å±±æ´é•¿åº¦å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span></p>
        </div>
    </div>

    <!-- Visualization Area -->
    <div class="visualization-area" id="visualization-section" style="display: none;">
        <h4>è¿‡ç¨‹å¯è§†åŒ–</h4>
        <div id="tunnel-visualization">
            <div id="tunnel-element" class="tunnel">å±±æ´</div>
            <div id="train-element" class="train">ç«è½¦</div>
            <!-- Distance markers will be added here -->
        </div>
         <p style="font-size: 0.85em; color: #555; text-align: center; margin-top: 15px;">
            (å¯è§†åŒ–æŒ‰æ¯”ä¾‹æ˜¾ç¤ºï¼Œç‚¹å‡»æŒ‰é’®åç«è½¦å°†æ¨¡æ‹Ÿé€šè¿‡å±±æ´)
        </p>
    </div>

    <!-- Calculation Steps Area -->
    <div class="calculation-area" id="calculation-section" style="display: none;">
        <h4>è§£é¢˜æ€è·¯ä¸è®¡ç®—è¿‡ç¨‹</h4>
        <div id="calculation-steps">
            <!-- Calculation steps will be generated here -->
        </div>
    </div>


    <script>
        // Get DOM elements
        const speedInput = document.getElementById('speed-input');
        const timeInput = document.getElementById('time-input');
        const trainLengthInput = document.getElementById('train-length-input');
        const calculateButton = document.getElementById('calculate-button');
        const resultOutput = document.getElementById('result-output');
        const speedError = document.getElementById('speed-error');
        const timeError = document.getElementById('time-error');
        const trainLengthError = document.getElementById('train-length-error');

        const visualizationSection = document.getElementById('visualization-section');
        const tunnelVisualization = document.getElementById('tunnel-visualization');
        const tunnelElement = document.getElementById('tunnel-element');
        const trainElement = document.getElementById('train-element');

        const calculationSection = document.getElementById('calculation-section');
        const calculationSteps = document.getElementById('calculation-steps');

        let animationTimeout = null; // To control animation

        // Function to validate inputs
        function validateInputs() {
            speedError.textContent = '';
            timeError.textContent = '';
            trainLengthError.textContent = '';
            let isValid = true;

            const speed = parseFloat(speedInput.value);
            const time = parseFloat(timeInput.value);
            const trainLength = parseFloat(trainLengthInput.value);

            if (isNaN(speed) || speed <= 0) {
                speedError.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°é€Ÿåº¦ã€‚';
                isValid = false;
            }
            if (isNaN(time) || time <= 0) {
                timeError.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°æ—¶é—´ã€‚';
                isValid = false;
            }
             if (isNaN(trainLength) || trainLength < 0) { // Allow 0 length for theoretical cases? No, require positive.
                 trainLengthError.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°ç«è½¦é•¿åº¦ã€‚';
                 isValid = false;
             } else if (!Number.isInteger(trainLength) && trainLengthInput.value.includes('.')) {
                 // Allow integer input for train length as it's usually whole meters
                 // trainLengthError.textContent = 'ç«è½¦é•¿åº¦é€šå¸¸ä¸ºæ•´æ•°ç±³ã€‚';
                 // isValid = false; // Decide if you want to enforce integer
             }


            return isValid ? { speed, time, trainLength } : null;
        }

        // Function to display calculation steps
        function displayCalculationSteps(speed, time, trainLength, totalDistance, tunnelLength) {
            calculationSteps.innerHTML = ''; // Clear previous steps
            let stepsHtml = `
                <p><strong>é—®é¢˜åˆ†æï¼š</strong>ç«è½¦â€œå®Œå…¨é€šè¿‡â€å±±æ´ï¼Œæ„å‘³ç€ä»ç«è½¦å¤´è¿›å…¥å±±æ´å¼€å§‹ï¼Œç›´åˆ°ç«è½¦å°¾ç¦»å¼€å±±æ´ç»“æŸã€‚</p>
                <p class="important"><strong>å…³é”®ç‚¹ï¼š</strong>åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç«è½¦è¡Œé©¶çš„æ€»è·ç¦» <strong>ä¸ä»…ä»…æ˜¯</strong> å±±æ´çš„é•¿åº¦ï¼Œè€Œæ˜¯ <strong>å±±æ´é•¿åº¦ + ç«è½¦è‡ªèº«çš„é•¿åº¦</strong>ï¼</p>
                <p class="formula">æ€»è·ç¦» = é€Ÿåº¦ Ã— æ—¶é—´</p>
                <p>ä»£å…¥æ•°å€¼ï¼šæ€»è·ç¦» = ${speed} <span class="unit">ç±³/ç§’</span> Ã— ${time} <span class="unit">ç§’</span></p>
                <p>è®¡ç®—ç»“æœï¼šæ€»è·ç¦» = <strong>${totalDistance.toFixed(2)}</strong> <span class="unit">ç±³</span></p>
                <p>è¿™ä¸ªæ€»è·ç¦»æ˜¯ç«è½¦ä»â€œå¤´è¿›â€åˆ°â€œå°¾å‡ºâ€èµ°è¿‡çš„è·¯ç¨‹ã€‚</p>
                <p class="formula">æ€»è·ç¦» = å±±æ´é•¿åº¦ + ç«è½¦é•¿åº¦</p>
                <p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åè¿‡æ¥è®¡ç®—å±±æ´é•¿åº¦ï¼š</p>
                <p class="formula">å±±æ´é•¿åº¦ = æ€»è·ç¦» - ç«è½¦é•¿åº¦</p>
                <p>ä»£å…¥æ•°å€¼ï¼šå±±æ´é•¿åº¦ = ${totalDistance.toFixed(2)} <span class="unit">ç±³</span> - ${trainLength} <span class="unit">ç±³</span></p>
                <p>è®¡ç®—ç»“æœï¼šå±±æ´é•¿åº¦ = <strong>${tunnelLength.toFixed(2)}</strong> <span class="unit">ç±³</span></p>
                <p class="mistake"><strong>æ˜“é”™ç‚¹æé†’ï¼š</strong>å¦‚æœç›´æ¥ç”¨ é€Ÿåº¦ Ã— æ—¶é—´ æ¥è®¡ç®—å±±æ´é•¿åº¦ï¼ˆ${(speed * time).toFixed(2)} ç±³ï¼‰ï¼Œå°±å¿˜è®°å‡å»ç«è½¦çš„é•¿åº¦äº†ï¼è¿™æ˜¯å¸¸è§çš„é”™è¯¯å“¦ï¼</p>
            `;
            calculationSteps.innerHTML = stepsHtml;
            calculationSection.style.display = 'block'; // Show the section
        }

        // Function to setup and run visualization
        function runVisualization(speed, time, trainLength, tunnelLength) {
            visualizationSection.style.display = 'block'; // Show the section
            clearTimeout(animationTimeout); // Clear previous animation if any

            const vizWidth = tunnelVisualization.clientWidth; // Get width of the container
            if (vizWidth <= 0) return; // Don't run if container not visible/sized

            // --- Scaling ---
            // Decide on a scale factor (pixels per meter)
            // Make the total distance (tunnel + train) fit reasonably well
            const totalDistance = tunnelLength + trainLength;
            let scale = vizWidth * 0.8 / totalDistance; // Try to fit 80% of the width

            // Limit scale to prevent elements becoming too small or too large
            scale = Math.min(scale, 5); // Max scale
            scale = Math.max(scale, 0.5); // Min scale

            const trainWidthPx = Math.max(15, trainLength * scale); // Min width for visibility
            const tunnelWidthPx = Math.max(20, tunnelLength * scale); // Min width for visibility
            const totalDistancePx = trainWidthPx + tunnelWidthPx;

            // --- Positioning ---
            // Center the tunnel roughly if possible, leave space for train entry/exit
            const tunnelMargin = (vizWidth - tunnelWidthPx) / 2;
            const tunnelLeftPx = Math.max(trainWidthPx * 0.5, tunnelMargin); // Ensure some space left

            tunnelElement.style.width = `${tunnelWidthPx}px`;
            tunnelElement.style.left = `${tunnelLeftPx}px`;
            tunnelElement.textContent = `å±±æ´ (${tunnelLength.toFixed(0)}m)`;

            trainElement.style.width = `${trainWidthPx}px`;
            trainElement.textContent = `ç«è½¦ (${trainLength}m)`;

            // --- Animation ---
            // Start position: Train nose just about to enter tunnel
            const startLeftPx = tunnelLeftPx - trainWidthPx;
            // End position: Train tail just leaving the tunnel
            const endLeftPx = tunnelLeftPx + tunnelWidthPx;

            // Reset train position instantly
            trainElement.style.transition = 'none';
            trainElement.style.left = `${startLeftPx}px`;

            // Force reflow to apply the initial position before starting transition
            void trainElement.offsetWidth;

            // Calculate animation duration based on the *scaled* time
            // The visual time should match the input time for clarity
            const animationDuration = time; // Use the actual time input for duration

            // Start the animation
            trainElement.style.transition = `left ${animationDuration}s linear`;
            trainElement.style.left = `${endLeftPx}px`;

            // Optional: Reset after animation (add a delay)
            animationTimeout = setTimeout(() => {
                 trainElement.style.transition = 'none';
                 trainElement.style.left = `${startLeftPx}px`; // Reset to start
            }, (animationDuration + 1) * 1000); // Reset 1 second after animation ends

            // --- Add Distance Markers (Optional) ---
            // Clear previous markers
            tunnelVisualization.querySelectorAll('.distance-marker, .distance-label').forEach(el => el.remove());

            // Marker for total distance
            const markerTotal = document.createElement('div');
            markerTotal.className = 'distance-marker';
            markerTotal.style.left = `${startLeftPx + trainWidthPx}px`; // Start of total distance (train nose enters)
            markerTotal.style.width = `${totalDistancePx}px`; // Width is total distance
            markerTotal.style.top = '10px';
            markerTotal.style.borderBottom = '1px solid #3498db';

            const labelTotal = document.createElement('div');
            labelTotal.className = 'distance-label';
            labelTotal.style.left = `${startLeftPx + trainWidthPx + totalDistancePx / 2}px`;
            labelTotal.style.top = '0px';
            labelTotal.textContent = `æ€»è·¯ç¨‹: ${totalDistance.toFixed(0)}m (å±±æ´+ç«è½¦)`;

            tunnelVisualization.appendChild(markerTotal);
            tunnelVisualization.appendChild(labelTotal);
        }


        // Main calculation function
        function calculateTunnelLength() {
            // 1. Validate Inputs
            const inputs = validateInputs();
            if (!inputs) {
                // Hide results and visualization if validation fails
                resultOutput.innerHTML = '<span class="label">å±±æ´é•¿åº¦å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>';
                visualizationSection.style.display = 'none';
                calculationSection.style.display = 'none';
                clearTimeout(animationTimeout); // Stop any ongoing animation
                trainElement.style.transition = 'none'; // Stop movement
                return;
            }

            const { speed, time, trainLength } = inputs;

            // 2. Calculate Total Distance traveled by the train head
            const totalDistance = speed * time;

            // 3. Calculate Tunnel Length
            const tunnelLength = totalDistance - trainLength;

            // 4. Display Result
            if (tunnelLength < 0) {
                 resultOutput.innerHTML = `<span class="label" style="color: #e74c3c;">è®¡ç®—é”™è¯¯!</span> ç«è½¦é•¿åº¦ (${trainLength}m) å¤§äºæ€»è·¯ç¨‹ (${totalDistance.toFixed(1)}m)ã€‚è¯·æ£€æŸ¥è¾“å…¥å€¼ã€‚`;
                 visualizationSection.style.display = 'none';
                 calculationSection.style.display = 'none';
                 clearTimeout(animationTimeout);
                 trainElement.style.transition = 'none';
            } else {
                resultOutput.innerHTML = `<span class="label">è®¡ç®—å¾—å‡ºå±±æ´é•¿åº¦ä¸ºï¼š</span>${tunnelLength.toFixed(2)} <span class="unit">ç±³</span>`;

                // 5. Display Steps
                displayCalculationSteps(speed, time, trainLength, totalDistance, tunnelLength);

                // 6. Run Visualization
                runVisualization(speed, time, trainLength, tunnelLength);
            }
        }

        // Add event listener to the button
        calculateButton.addEventListener('click', calculateTunnelLength);

        // Optional: Calculate on Enter key press
        speedInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') calculateTunnelLength(); });
        timeInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') calculateTunnelLength(); });
        trainLengthInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') calculateTunnelLength(); });

    </script>

</body>
</html>